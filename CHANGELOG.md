# Changelog

All notable changes to this project are documented here.

## [Unreleased]

### Security

- **.env.example placeholders** – Replaced weak example values (`my-test-key`, `changeme`, `my-test-salt`) with `REPLACE_WITH_STRONG_SECRET` / `REPLACE_ME` so they are not used in production; added a note that placeholder values must not be used in production.

### Added

- **Local translate services: reactbits, snyk, sqlite, github** – Four new stdio→SSE translate services (ports 8022–8025). reactbits runs `reactbits-dev-mcp-server`; snyk runs `snyk mcp -t stdio --experimental` (set `SNYK_TOKEN` in .env); sqlite runs `mcp-sqlite` (npm) with configurable `SQLITE_DB_PATH` and `SQLITE_VOLUME`; github runs `@modelcontextprotocol/server-github` (set `GITHUB_PERSONAL_ACCESS_TOKEN` in .env). `scripts/gateways.txt`, `.env.example`, and README table updated.

- **register-gateways.sh curl timeouts** – POST to /gateways now uses --connect-timeout 10 and --max-time 45 so the script does not hang when the gateway is slow to validate URLs.
- **register-gateways.sh idempotent for "already exists"** – When the API returns "Gateway name already exists" (e.g. after restart with same DB), the script now reports "OK name (already registered)" instead of FAIL, so re-running after start is safe.
- **Translate services bind to 0.0.0.0** – All translate commands in docker-compose now pass `--host 0.0.0.0` so the SSE server accepts connections from the gateway container (default was 127.0.0.1, causing "Unable to connect to gateway" when registering local gateways). README Troubleshooting updated.
- **SQLite corruption recovery** – README Troubleshooting and data/README.md now document how to fix "database disk image is malformed" / "FileLock health check failed": stop stack, remove `./data/mcp.db` (and `-shm`/`-wal` if present), restart; re-register gateways after.

- **README: URL-based Cursor connection** – Documented correct virtual server paths (`/sse` and `/mcp`) and that auth (Bearer JWT) is required; added troubleshooting for "Method Not Allowed" and "Invalid OAuth error response" when the path or auth is missing.

- **data/README.md** – Documents the data directory (SQLite persistence) and lists the nine local Docker translate services (name, port, internal URL) for reference.
- **Local translate services for all stdio MCP servers** – `./start.sh` now starts gateway plus nine translate services (sequential-thinking, chrome-devtools, playwright, magicuidesign-mcp, desktop-commander, puppeteer, browser-tools, tavily, filesystem). Each runs stdio→SSE via `mcpgateway.translate`; `scripts/gateways.txt` and `./scripts/register-gateways.sh` register them. Optional env: `TAVILY_API_KEY`, `FILESYSTEM_PATH`, `FILESYSTEM_VOLUME`. README table and "Servers that stay in Cursor or as remote gateways" note; `.env.example` documents optional ports and filesystem/tavily vars.

### Fixed

- **Translate image build race** – All translate services shared the same image and `build` block, so Compose built in parallel and multiple services tried to export the same tag, causing "already exists" and CANCELED. The build is now defined only on `sequential-thinking`; other services use the same image and no longer trigger a build, so the image is built once and reused.
- **Translate containers crash (FileNotFoundError: npx)** – Dockerfile.translate now installs `npm` so `npx` is available in the image; translate services no longer restart loop. Register script shows API error message on FAIL and suggests checking `docker compose logs <service>` on 503.

- **register-gateways.sh** – Script retries gateway `/health` every 3s for up to 90s (`REGISTER_GATEWAY_MAX_WAIT`) instead of failing immediately on "health got 000". If health fails with the current host, it retries with the other (localhost ↔ 127.0.0.1) for another 90s to handle Docker Desktop and similar environments. Final error suggests `docker compose ps gateway` and `docker compose logs gateway`. Optional `REGISTER_WAIT_SECONDS` for translate containers. FAIL suggests `REGISTER_VERBOSE=1`. README and `.env.example` updated.
- **register-gateways.sh health check** – Health-check loop now prints progress to stderr every 3s (elapsed time and "OK after Ns" on success) so the script does not appear stuck. When `GATEWAY_URL` uses 127.0.0.1, the script tries localhost first, then 127.0.0.1 as fallback, so Docker Desktop for Mac usually succeeds without a long wait. `.env.example` and README Troubleshooting updated (localhost vs 127.0.0.1 on Mac).
- **register-gateways.sh FAIL output** – On registration failure, script now shows API `detail` when present (in addition to `message`). Shorter per-FAIL hint (docker compose logs). Single end-of-run hint when any local translate gateway failed: REGISTER_VERBOSE=1, REGISTER_WAIT_SECONDS=30, docker compose ps.

- **Dockerfile.translate build** – Context Forge image has no package manager; base switched to `python:3.12-slim`, install Node via apt-get and `mcp-contextforge-gateway` via pip so the translate service (e.g. sequential-thinking) builds and runs.

### Changed

- **register-gateways.sh feedback** – Script now prints progress: "Register gateways – checking environment...", "Waiting for gateway at URL (up to Ns)...", "Gateway ready at URL", "Generating JWT...", "JWT generated.", "Registering gateways from EXTRA_GATEWAYS/scripts/gateways.txt...", and "Done." so the user sees each phase.
- **start.sh feedback** – Script now prints progress: "MCP Gateway – checking environment...", "Using: docker compose", and a clear message before each action (e.g. "Building and starting gateway + translate services (first run may take 1–2 min)..."). Success output shows Admin UI URL using PORT from .env and next steps (register, stop).
- **README Troubleshooting** – Added "Failed to initialize gateway" (e.g. Context Awesome 406 / Accept header) and MCP Registry "Failed" (retry or add manually, OAuth pointer).
- **Default start includes all local servers** – `./start.sh` now starts the gateway and sequential-thinking (and any future local translate services); removed profile so they always run. Use `./start.sh gateway-only` for gateway alone. README and register script updated.
- **Register gateways script and URL-based docs** – `scripts/register-gateways.sh` registers gateways from `scripts/gateways.txt` (Name|URL|Transport per line) or `EXTRA_GATEWAYS` in .env. JWT from gateway container. README: "Registering URL-based MCP servers" with table, auth note (v0/apify in Admin UI), and sequential-thinking "Failed to initialize" troubleshooting.
- **Optional sequential-thinking service** – `./start.sh sequential-thinking` starts the gateway plus a translate container that runs the [sequential-thinking](https://github.com/modelcontextprotocol/servers/tree/main/src/sequentialthinking) MCP server (stdio→SSE). Add gateway in Admin UI with URL `http://sequential-thinking:8013/sse`, Transport SSE. `Dockerfile.translate` (Node on top of Context Forge image) and compose profile `sequential-thinking` added; README and .env.example updated.
- **Single start script, gateway-only Docker** – One script: `./start.sh` (start) and `./start.sh stop` (stop). Removed `scripts/` (down.sh, full-setup.sh, up.sh, setup-context-forge-cursor.sh), `Dockerfile.translate`, and `docs/TROUBLESHOOTING.md`. Docker Compose now has only the gateway service; data in `./data`. README and `.env.example` reduced to gateway-only. Pipeline rule updated to reference `start.sh` and README.
- **Removed gateway registration automation** – Deleted scripts that automated adding MCP servers: `register-gateways.sh`, `register-gateways-admin-ui.py`, `configure-gateways-via-admin-ui.py`, `run-configure-admin-ui.sh`, and shared modules `gateways_config.py`, `mcpgateway_admin.py`. Gateways are added manually via Admin UI (Gateways). Removed `requirements.txt` and `requirements-playwright.txt`. Updated README (setup step 3 = add gateways in Admin UI), full-setup.sh (no register step), TROUBLESHOOTING.md, and .env.example (dropped GATEWAY_WAIT, REGISTER_DELAY, REGISTER_TIMEOUT, ADMIN_UI_TIMEOUT, REGISTER_PROFILES).
- **Docs cleanup** – Removed redundant docs (A2A_AGENTS_AND_RESOURCES, MCP_REGISTRY_AND_GROUPS, MCP_SERVERS_RECOMMENDED, MCPMARKET_SKILLS, PIPELINE). Setup pipeline and references consolidated into README. TROUBLESHOOTING.md trimmed to essential issues (gateway not ready, 503, network, port, venv). Single source of truth: README + TROUBLESHOOTING.

### Added

- **run-configure-admin-ui.sh starts gateway if unreachable** – The runner sources `.env`, defaults `GATEWAY_URL` from `PORT` when unset, and if the gateway is not reachable it runs `docker compose up -d` (or `docker-compose up -d`), waits for `/health` (honors `UP_WAIT_GATEWAY`), then runs the Playwright configure script. So `./scripts/run-configure-admin-ui.sh` can be run without starting the stack first.
- **Configure all MCP gateways via web admin panel** – Playwright script `scripts/configure-gateways-via-admin-ui.py` logs in to the admin UI, adds gateways from the canonical list (and `EXTRA_GATEWAYS`), then creates/updates the virtual server via the admin API (JWT). Credentials from `.env`. Optional: `pip install -r requirements-playwright.txt` and `playwright install chromium`. Shared gateways list in `scripts/gateways_config.py`; admin API helpers in `scripts/mcpgateway_admin.py`. README "Configure via Admin UI (automated)" and [docs/PIPELINE.md](docs/PIPELINE.md), [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) updated.
- **Python script to register gateways (Option B)** – When `./scripts/register-gateways.sh` times out (HTTP 000) or you prefer not to use the shell script, use `python scripts/register-gateways-admin-ui.py`. The script builds a JWT from `.env` and registers gateways and creates/updates the `mcpmarket` virtual server via the admin API. API responses are normalized for array or wrapped shapes. Requires Python 3.10+ and `pip install -r requirements.txt`. See README (Option B) and [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md).
- **Tools separated and tagged by technology** – Docker Compose profiles for toggling: `full` (all 5 mcpmarket-style), `node` (task-master, superpowers, chrome-browser), `python` (beads, gpt-researcher), `reference` (time, fetch, memory, sequential-thinking, filesystem, git). Existing 5 services have multiple profiles; 6 reference translate services under profile `reference`. `scripts/register-gateways.sh` includes reference gateways; failed gateways (e.g. profile not up) are skipped.
- **MCP registry and groups** – [docs/MCP_REGISTRY_AND_GROUPS.md](docs/MCP_REGISTRY_AND_GROUPS.md): how to use the admin MCP registry at http://localhost:4444/admin/#mcp-registry, link to [official MCP Registry](https://registry.modelcontextprotocol.io), and server groups (reference, node, python) for adding servers and organizing tools. README points to the registry doc.
- **Reference profile: filesystem and git** – `translate-filesystem` (path `/workspace`, volume `FILESYSTEM_WORKSPACE`) and `translate-git` (working dir `/repo`, volume `GIT_REPO_PATH`) under profile `reference`; ports 8014, 8015. `.env.example` and register-gateways.sh updated.
- **register-gateways.sh JWT** – Script now generates the Bearer token from the gateway container (`sh -c '...'` using container env) so the JWT secret always matches the gateway. Prefer container token when the gateway container is running; fall back to `MCPGATEWAY_BEARER_TOKEN` from `.env` only when the container is not running.
- **Java & Spring AI MCP** – [docs/MCP_SERVERS_RECOMMENDED.md](docs/MCP_SERVERS_RECOMMENDED.md) "Java & Spring AI MCP" section: links to [modelcontextprotocol/java-sdk](https://github.com/modelcontextprotocol/java-sdk) and [Spring AI MCP](https://docs.spring.io/spring-ai-mcp/reference/overview.html); run Java servers on host and add via `EXTRA_GATEWAYS`.
- **A2A recommendation** – [docs/A2A_AGENTS_AND_RESOURCES.md](docs/A2A_AGENTS_AND_RESOURCES.md) "Recommended for this gateway" subsection: when to enable A2A and register agents.
- **.env.example** – Optional reference profile ports (`TIME_PORT`, `FETCH_PORT`, `MEMORY_PORT`, `SEQUENTIAL_THINKING_PORT`) and stdio commands; comment listing profiles (full, node, python, reference).
- **scripts/up.sh** – Start stack with profiles without caring about `docker compose` vs `docker-compose`: `./scripts/up.sh full reference`; no args = gateway only. Picks compose command automatically.
- **scripts/down.sh** – Tear down stack with same profile args as `up.sh` (e.g. `./scripts/down.sh full reference`) so all containers and the network are removed. Avoids "Network mcp-gateway-net Resource is still in use" when you previously started with profiles. See [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md).
- **Host all planned MCP servers** – `Dockerfile.translate` extends Context Forge with Node.js so all translate services (Python and Node-based) run in Docker. All translate services use image `mcp-gateway-translate:latest`; `./scripts/up.sh full reference` builds it if missing, then starts the stack. `.dockerignore` added for faster builds. README and [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) updated for hosting all servers.

### Changed

- **Gateway URL resolution** – `get_base_url()` in `mcpgateway_admin.py` uses `PORT` from `.env` when `GATEWAY_URL` is unset (default `http://127.0.0.1:4444`), so scripts stay in sync with `docker-compose` port mapping.
- **Option B Python script (register-gateways-admin-ui.py)** – Uses JWT (from `PLATFORM_ADMIN_EMAIL` and `JWT_SECRET_KEY` in `.env`) for admin API auth instead of Selenium/session cookies. Removes dependency on Chrome and Selenium; requires only `python-dotenv`, `requests`, and `PyJWT`. Fixes 401 "Authorization token required" and connection-aborted errors. Honors `REGISTER_DELAY` (default 25s after gateway health) and `GATEWAY_WAIT` (default 90s for gateway health poll) from `.env` so users can wait longer for a slow-starting gateway. Reduces 503 "Unable to connect to gateway" when run right after `./scripts/up.sh`. See [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) for "Gateway not reachable". See README (Option B) and [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md).
- **.cursor as global config** – Removed LukBot-specific content so this repo works as a global Cursor config for any project. Session context, COMMANDS.md, and skills (backend-express, frontend-react-vite, e2e-playwright, mcp-docs-search) are now generic; LukBot-only skills (discord-commands, music-queue-player, lukbot-docker-dev, prisma-redis-lukbot) removed. README Cursor connection step no longer links to LukBot; template is inline.
- **README** – "Profiles (toggle by technology)" recommends `./scripts/up.sh [profiles]` so profile start works on systems where `docker compose` does not support `--profile`; direct `docker-compose` examples for copy-paste. "Full stack: registering gateways" notes that script registers all gateways and skips unreachable ones; pointer to Java & Spring AI MCP in MCP_SERVERS_RECOMMENDED.md.
- **docs/PIPELINE.md** – Step 2 mentions profiles (node, python, reference). [docs/MCP_SERVERS_RECOMMENDED.md](docs/MCP_SERVERS_RECOMMENDED.md) "Adding to Context Forge" includes profiles and register-gateways behavior.

## [1.0.0]

### Added

- **Git repository** – Initialized git repo with `.gitignore` for env/secrets (`.env`, `.cursor/.env.mcp`), SQLite data files (`data/*.db*`), OS/IDE artifacts, logs, and build output.
- **Docker Compose** – `docker-compose.yml` with gateway service and optional translate sidecars (profile `full`) for stdio-to-SSE: beads, gpt-researcher, task-master, superpowers, chrome-browser. Gateway-only: `docker compose up -d`; full stack: `docker compose --profile full up -d`.
- **Gateway registration** – `scripts/register-gateways.sh` for idempotent registration of translate endpoints with the gateway (internal Docker URLs). Documented manual `POST /gateways` and virtual server creation in README.
- **Documentation** – README updated with run modes (gateway only vs full stack), registration steps, Cursor connection (Docker wrapper), and env vars. `.env.example` extended with optional Compose ports, stdio commands, and API keys for upstream MCP servers.
- **mcpmarket skills** – README documents adding [mcpmarket.com/tools/skills](https://mcpmarket.com/tools/skills) as global Cursor rules at `~/.cursor/rules/` or `~/.cursor/skills-cursor/` (no rule files in this repo). [docs/MCPMARKET_SKILLS.md](docs/MCPMARKET_SKILLS.md) lists all skills and mcpmarket server URLs.
- **Virtual server API** – `POST /servers` body uses `{"server":{...}}`. Scripts and README updated. `register-gateways.sh`: portable `sed '$d'` instead of `head -n -1`.
- **Virtual server "mcpmarket"** – Created via API (id `d80befa083604f8393729069e399d21e`) when gateways are unavailable (gateway-only mode); add tools after running full stack and `./scripts/register-gateways.sh`.
- **MCP servers from mcpservers.org, mcp.so & reference** – [docs/MCP_SERVERS_RECOMMENDED.md](docs/MCP_SERVERS_RECOMMENDED.md) extended with a section of free, good servers from [mcpservers.org](https://mcpservers.org/), [mcp.so](https://mcp.so/), and [modelcontextprotocol/servers](https://github.com/modelcontextprotocol/servers) (Time, Fetch, Memory, Sequential Thinking, Filesystem, Git, Playwright, Puppeteer, Firecrawl, Brave Search) plus links to those indexes in Curated lists.
- **A2A agents, tools, prompts, resources** – [docs/A2A_AGENTS_AND_RESOURCES.md](docs/A2A_AGENTS_AND_RESOURCES.md) added: A2A (Agent-to-Agent) in Context Forge (enable, register, associate with virtual server), free A2A resources ([a2aprotocol.org](https://www.a2aprotocol.org/en), [A2A GitHub](https://github.com/a2aproject/A2A)), and pointers for MCP tools, prompts, and resources. Optional `.env` vars for A2A documented in `.env.example`.
- **Middleware & plugins** – README section added: no custom middleware/plugins in this repo; Context Forge’s built-in plugin system and observability (OpenTelemetry, Prometheus) documented; reverse proxy (nginx/Caddy) only when needed (TLS, rate limiting, logging).
- **Implement docs to Context Forge** – `scripts/register-gateways.sh` now creates or updates the virtual server `mcpmarket` and associates all tools from `GET /tools` with it (requires `jq`). Optional `EXTRA_GATEWAYS` in `.env` (format: `name|url,name|url`) registers additional gateways (e.g. reference servers run on the host). README and [docs/MCP_SERVERS_RECOMMENDED.md](docs/MCP_SERVERS_RECOMMENDED.md) updated.
- **Setup pipeline and Cursor configuration** – [docs/PIPELINE.md](docs/PIPELINE.md) documents the setup sequence: Environment → Start stack → Register gateways (full stack) → **Cursor configuration** → Restart Cursor. README updated with pipeline section and Cursor configuration as step 4. `.cursor/rules/pipeline-cursor-config.mdc` added so the agent includes Cursor Configuration when documenting or automating setup. `scripts/full-setup.sh` runs the full pipeline (optionally with `USE_FULL_STACK=1` for full stack); Cursor must be restarted after.
